.. index:: ! text format

Conventions
-----------

The textual format for WebAssembly :ref:`modules <modules>` is a rendering of their :ref:`abstract syntax <syntax-module>` into *S-expressions*.

Like the :ref:`binary format <binary-format>`, the text format is defined by an *attribute grammar*.
A text string is a well-formed description of a module if and only if it is generated by the grammar.

Each production of this grammar has exactly one synthesized attribute: the abstract syntax that the respective byte sequence encodes.
Thus, the attribute grammar implicitly defines a *parsing* function.

Except for a few exceptions, the core of the text grammar closely mirrors the grammar of the abstract syntax.
However, it also defines a number of forms that are *syntactic sugar* over the core syntax.

The recommended extension for source files containing WebAssembly modules in text format is ":math:`\T{.wat}`".


.. _text-grammar:
.. index:: grammar notation, notation
   single: text format; grammar
   pair: text format; notation

Grammar
~~~~~~~

The following conventions are adopted in defining grammar rules for the text format.
They mirror the conventions used for :ref:`abstract syntax <grammar>` and for the :ref:`binary format <binary-format>`.
In order to distinguish symbols of the textual syntax from symbols of the abstract syntax, typewriter font is adopted for the former.

* Input characters are written as either :ref:`byte values <syntax-bytes>`, :math:`\hex{0A}`, or literal characters of the 7-bit `ASCII <http://webstore.ansi.org/RecordDetail.aspx?sku=INCITS+4-1986%5bR2012%5d>`_ character set that represent their respective character codes.

* Terminal symbols are strings of `ASCII <http://webstore.ansi.org/RecordDetail.aspx?sku=INCITS+4-1986%5bR2012%5d>`_ characters enclosed in quotes: :math:`\text{module}`.

* Nonterminal symbols are written in typewriter font: :math:`\T{valtype}, \T{instr}`.

* Arbitrary :ref:`white space <text-whitespace>` is allowed in any place where the grammar contains spaces, except where noted otherwise, such as the :ref:`lexical syntax <text-lexical>`.

* :math:`T^n` is a sequence of :math:`n\geq 0` iterations  of :math:`T`.

* :math:`T^\ast` is a possibly empty sequence of iterations of :math:`T`.
  (This is a shorthand for :math:`T^n` used where :math:`n` is not relevant.)

* :math:`T^?` is an optional occurrence of :math:`T`.
  (This is a shorthand for :math:`T^n` where :math:`n \leq 1`.)

* :math:`x{:}T` denotes the same language as the nonterminal :math:`T`, but also binds the variable :math:`x` to the attribute synthesized for :math:`T`.

* Productions are written :math:`\T{name} ::= T \Rightarrow A`, where :math:`A` is the attribute that is synthesized for :math:`\T{name}`, usually from attribute variables bound in :math:`T`.

* Some productions are augmented by side conditions in parentheses, which restrict the applicability of the production. They provide a shorthand for a combinatorial expansion of the production into many separate cases.

.. note::
   For example, the :ref:`textual grammar <text-valtype>` for :ref:`value types <syntax-valtype>` is given as follows:

   .. math::
     \begin{array}{llcll@{\qquad\qquad}l}
     \production{value types} & \Tvaltype &::=&
       \text{i32} &\Rightarrow& \I32 \\ &&|&
       \text{i64} &\Rightarrow& \I64 \\ &&|&
       \text{f32} &\Rightarrow& \F32 \\ &&|&
       \text{f64} &\Rightarrow& \F64 \\
     \end{array}

   The :ref:`textual grammar <text-limits>` for :ref:`limits <syntax-limits>` is defined as follows:   

   .. math::
      \begin{array}{llclll}
      \production{limits} & \Tlimits &::=&
        n{:}\Tu32 &\Rightarrow& \{ \MIN~n, \MAX~\epsilon \} \\ &&|&
        n{:}\Tu32~~m{:}\Tu32 &\Rightarrow& \{ \MIN~n, \MAX~m \} \\
      \end{array}

   The variables :math:`n` and :math:`m` name the attributes of the respective |Tu32| nonterminals, which in this case are the actual :ref:`unsigned integers <syntax-uint>` they decode into.
   The attribute of the complete production then is the abstract syntax for the limit, expressed in terms of the former values.


.. _text-notation:

Auxiliary Notation
~~~~~~~~~~~~~~~~~~

When dealing with binary encodings the following notation is also used:

* :math:`\epsilon` denotes the empty byte sequence.
